<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Challenging Exits · OMG Network</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="The process of challenging exits takes place during a defined challenge period after an exit has started. The challenge period exists to provide time for other users to challenge dishonest exits."/><meta name="docsearch:version" content="1.0.0"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Challenging Exits · OMG Network"/><meta property="og:type" content="website"/><meta property="og:url" content="https://okalouti.github.io/"/><meta property="og:description" content="The process of challenging exits takes place during a defined challenge period after an exit has started. The challenge period exists to provide time for other users to challenge dishonest exits."/><meta property="og:image" content="https://okalouti.github.io/img/omisego-blue.svg"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://okalouti.github.io/img/omisego-blue.svg"/><link rel="shortcut icon" href="/img/favicon.ico"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-154130721-1"></script><script>
              window.dataLayer = window.dataLayer || [];
              function gtag(){dataLayer.push(arguments); }
              gtag('js', new Date());
              gtag('config', 'UA-154130721-1');
            </script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/omisego-white.svg" alt="OMG Network"/></a><a href="/versions"><h3>1.0.0</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/welcome" target="_self">Docs</a></li><li class=""><a href="network-connection-details" target="_self">Network Connection</a></li><li class=""><a href="/api-reference-introduction" target="_self">API</a></li><li class=""><a href="https://omisego.co/" target="_blank">Product</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Integration</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Introduction<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/welcome">About OMG Network</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Getting Started<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/quick-start">Quick Start</a></li><li class="navListItem"><a class="navItem" href="/quick-start-deposit">Make a Deposit</a></li><li class="navListItem"><a class="navItem" href="/quick-start-transaction">Send a Transaction</a></li><li class="navListItem"><a class="navItem" href="/quick-start-exit">Exit Funds</a></li><li class="navListItem"><a class="navItem" href="/quick-start-process-exits">Process Exits</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Integration<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/integration-introduction">Introduction</a></li><li class="navListItem"><a class="navItem" href="/deposits">Deposits</a></li><li class="navListItem"><a class="navItem" href="/transfers">Transfers</a></li><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Exits</h4><ul><li class="navListItem"><a class="navItem" href="/standard-exits">Standard Exits</a></li><li class="navListItem"><a class="navItem" href="/in-flight-exits">In Flight Exits</a></li></ul></div><li class="navListItem"><a class="navItem" href="/challenge-period">Challenge Period</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/challenging-exits">Challenging Exits</a></li><li class="navListItem"><a class="navItem" href="/process-exits">Process Exits</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Appendix<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/network-architecture">Network Architecture</a></li><li class="navListItem"><a class="navItem" href="/glossary">Glossary</a></li><li class="navListItem"><a class="navItem" href="/faq">FAQ</a></li><li class="navListItem"><a class="navItem" href="/managing-utxos">Managing UTXOs</a></li><li class="navListItem"><a class="navItem" href="/morevp-technical-overview">MoreVP Technical Overview</a></li><li class="navListItem"><a class="navItem" href="/blockchain-design">Blockchain Design</a></li><li class="navListItem"><a class="navItem" href="/byzantine-conditions">Byzantine Conditions</a></li><li class="navListItem"><a class="navItem" href="/exitbonds">Exit Bonds</a></li><li class="navListItem"><a class="navItem" href="/fees">Fees</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Migration Guides<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/migration-0.2-0.3">0.2 to 0.3</a></li><li class="navListItem"><a class="navItem" href="/migration-0.3-0.4">0.3 to 0.4</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 id="__docusaurus" class="postHeaderTitle">Challenging Exits</h1></header><article><div><span><p>The process of challenging exits takes place during a defined challenge period after an exit has started. The challenge period exists to provide time for other users to challenge dishonest exits.</p>
<h2><a class="anchor" aria-hidden="true" id="lifecycle"></a><a href="#lifecycle" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Lifecycle</h2>
<ol>
<li>Standard exit or in-flight exit is initiated.</li>
<li>Challenge period starts.</li>
<li>If the exit is dishonest, the Watcher will report a byzantine event.</li>
<li>Users on the network challenge and respond to reported byzantine events.</li>
<li>Challenge period expires. Any exit that is unchallenged is finalized, while any exit that is successfully challenged is cancelled. Bonds are rewarded to successful challengers, or returned to users who committed them.</li>
</ol>
<h2><a class="anchor" aria-hidden="true" id="watcher-alerts"></a><a href="#watcher-alerts" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Watcher Alerts</h2>
<p>The Watcher broadcasts any byzantine event it detects on the OMG Network. Should the event be challengeable, a user can decide whether or not to &quot;challenge&quot; based on this information.</p>
<blockquote>
<p>These events are reported in the Watcher's <code>/status.get</code> endpoint providing an array of byzantine events. <code>omg-js</code> provides a helper function to get this report.</p>
</blockquote>
<pre><code class="hljs css language-js">childChain.status()
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="challenging-standard-exits"></a><a href="#challenging-standard-exits" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Challenging Standard Exits</h2>
<p>The following is a byzantine event reported by the Watcher on invalid standard exits and requires action by users.</p>
<h4><a class="anchor" aria-hidden="true" id="invalid_exit"></a><a href="#invalid_exit" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>invalid_exit</code></h4>
<p>Indicates that an invalid standard exit is occurring. It should be challenged.</p>
<p><strong>Scenario</strong></p>
<ul>
<li>Alice sends <code>UTXO1</code> to Bob. The associated transaction is included in a block.</li>
<li>Alice initiates a standard exit on <code>UTXO1</code>.</li>
</ul>
<p><strong>Event</strong></p>
<p>Watcher reports an <code>invalid_exit</code>:</p>
<pre><code class="hljs css language-json">{
  <span class="hljs-attr">"event"</span>: <span class="hljs-string">"invalid_exit"</span>,
  <span class="hljs-attr">"details"</span>: {
    <span class="hljs-attr">"eth_height"</span>: <span class="hljs-number">3521678</span>,
    <span class="hljs-attr">"utxo_pos"</span>: <span class="hljs-number">10000000010000000</span>,
    <span class="hljs-attr">"owner"</span>: <span class="hljs-string">"0xb3256026863eb6ae5b06fa396ab09069784ea8ea"</span>,
    <span class="hljs-attr">"currency"</span>: <span class="hljs-string">"0x0000000000000000000000000000000000000000"</span>,
    <span class="hljs-attr">"amount"</span>: <span class="hljs-number">100</span>
  }
}
</code></pre>
<p><strong>Solution</strong></p>
<ul>
<li>Anyone can challenge Alice’s exit by proving that Alice has already spent the UTXO in another transaction.</li>
<li>If the challenge is successful, Alice does not exit the tokens and the challenger is awarded the exit bond that Alice put up when starting the exit.</li>
</ul>
<p><strong>Implementation</strong></p>
<p>We can use the byzantine event information reported by the Watcher to retrieve the data required to challenge the exit. We then can make a call to the <code>Payment Exit Game</code> contract calling <code>challengeStandardExit()</code>.</p>
<p>In the example below, Bob has seen the reported <code>invalid_exit</code> event and proceeds to challenge the exit. He will receive Alice's posted bond if the challenge is successful.</p>
<pre><code class="hljs css language-js"><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">challengeInvalidExit</span> (<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">const</span> challengeData = <span class="hljs-keyword">await</span> childChain.getChallengeData(invalidExit.details.utxo_pos)
  <span class="hljs-keyword">return</span> rootChain.challengeStandardExit({
    <span class="hljs-attr">standardExitId</span>: challengeData.exit_id,
    <span class="hljs-attr">exitingTx</span>: challengeData.exiting_tx,
    <span class="hljs-attr">challengeTx</span>: challengeData.txbytes,
    <span class="hljs-attr">inputIndex</span>: challengeData.input_index,
    <span class="hljs-attr">challengeTxSig</span>: challengeData.sig,
    <span class="hljs-attr">txOptions</span>: {
      <span class="hljs-attr">from</span>: Bob,
      <span class="hljs-attr">privateKey</span>: BobPrivateKey
    }
  })
}
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="challenging-in-flight-exits"></a><a href="#challenging-in-flight-exits" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Challenging In-Flight Exits</h2>
<p>The following are byzantine events reported by the Watcher on invalid in-flight exits and require action by users.</p>
<h4><a class="anchor" aria-hidden="true" id="noncanonical_ife"></a><a href="#noncanonical_ife" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>noncanonical_ife</code></h4>
<p>Indicates an in-flight exit of a non-canonical transaction has been started. It should be challenged.</p>
<p><strong>Scenario</strong></p>
<ul>
<li>Alice creates a transaction <code>TX1</code> to Bob, using <code>UTXO1</code> as an input. <code>TX1</code> is included in a block.</li>
<li>Alice then creates a non-canonical transaction <code>TX2</code> to Carol with the same input <code>UTXO1</code> (double spend). <code>TX2</code> is not included in a block.</li>
<li>Alice initiates an in-flight exit on <code>TX2</code>.</li>
</ul>
<p><strong>Event</strong></p>
<ul>
<li>Watcher reports a <code>noncanonical_ife</code>:</li>
</ul>
<pre><code class="hljs css language-json">{
  <span class="hljs-attr">"event"</span>: <span class="hljs-string">"noncanonical_ife"</span>,
  <span class="hljs-attr">"details"</span>: {
    <span class="hljs-attr">"txbytes"</span>: <span class="hljs-string">"0xf3170101c0940000..."</span>
  }
}
</code></pre>
<p><strong>Solution</strong></p>
<ul>
<li>Bob sees that Alice has initiated an in-flight exit on a non-canonical transaction.</li>
<li>Bob challenges Alice's in-flight exit by showing that <code>UTXO1</code> was spent in <code>TX1</code>.</li>
<li>Alice is unable to exit <code>UTXO1</code> and loses her exit bond to Bob.</li>
</ul>
<p><strong>Implementation</strong></p>
<pre><code class="hljs css language-js">rootChain.challengeInFlightExitNonCanonical({
  inputTx,
  inputUtxoPos,
  inFlightTx,
  inFlightTxInputIndex,
  competingTx,
  competingTxInputIndex,
  competingTxPos,
  competingTxInclusionProof,
  competingTxWitness,
  <span class="hljs-attr">txOptions</span>: {
    <span class="hljs-attr">from</span>: Bob,
    <span class="hljs-attr">privateKey</span>: BobPrivateKey,
  }
})
</code></pre>
<h4><a class="anchor" aria-hidden="true" id="invalid_ife_challenge"></a><a href="#invalid_ife_challenge" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>invalid_ife_challenge</code></h4>
<p>Indicates a canonical in-flight exit has been challenged. The challenge should be responded to.</p>
<p><strong>Scenario</strong></p>
<ul>
<li>Alice sends <code>UTXO1</code> to Bob, but Bob does not see the transaction <code>TX1</code> get included in a block. He assumes the operator is withholding, so he attempts to exit his output via an in-flight exit.</li>
<li>Bob starts his in-flight exit on <code>TX1</code>.</li>
<li>Alice sends a transaction <code>TX2</code> to Carol using the same <code>UTXO1</code> (double spend). This transaction is not included in a block.</li>
<li><code>TX1</code> is eventually included in a block.</li>
<li>Carol sees that Bob is trying to exit a transaction with the same input that Alice has sent her.</li>
<li>Carol uses <code>TX2</code>to challenge Bob's IFE as non-canonical.</li>
</ul>
<p><strong>Event</strong></p>
<p>The Watcher reports an <code>invalid_ife_challenge</code>:</p>
<pre><code class="hljs css language-json">{
  <span class="hljs-attr">"event"</span>: <span class="hljs-string">"invalid_ife_challenge"</span>,
  <span class="hljs-attr">"details"</span>: {
    <span class="hljs-attr">"txbytes"</span>: <span class="hljs-string">"0xf3170101c0940000..."</span>
  }
}
</code></pre>
<p><strong>Solution</strong></p>
<ul>
<li>Bob uses <code>TX1</code> (along with its inclusion proof) to prove that the challenge is invalid.</li>
</ul>
<p><strong>Implementation</strong></p>
<pre><code class="hljs css language-js"><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">respondToInvalidIFEChallenge</span> (<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">const</span> proof = <span class="hljs-keyword">await</span> childChain.inFlightExitProveCanonical(invalidChallenge.details.txbytes)
  <span class="hljs-keyword">return</span> rootChain.respondToNonCanonicalChallenge({
    <span class="hljs-attr">inFlightTx</span>: proof.in_flight_txbytes,
    <span class="hljs-attr">inFlightTxPos</span>: proof.in_flight_tx_pos,
    <span class="hljs-attr">inFlightTxInclusionProof</span>: proof.in_flight_proof,
    <span class="hljs-attr">txOptions</span>: {
      <span class="hljs-attr">from</span>: Bob
      <span class="hljs-attr">privateKey</span>: BobPrivateKey,
    }
  })
}
</code></pre>
<h4><a class="anchor" aria-hidden="true" id="invalid_piggyback"></a><a href="#invalid_piggyback" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>invalid_piggyback</code></h4>
<p>Indicates an invalid piggyback is in process. Should be challenged.</p>
<p><strong>Scenario</strong></p>
<ul>
<li>Alice sends <code>UTXO1</code> to Bob in <code>TX1</code>. <code>TX1</code> is included in a block.</li>
<li>Bob initiates an in-flight exit on <code>TX1</code> and places an <code>exit_bond</code>.</li>
<li>Bob piggybacks onto the exit referencing <code>UTXO1</code> and commiting a <code>piggyback bond</code>.</li>
<li>Bob sends <code>UTXO1</code> to Carol in <code>TX2</code>. <code>TX2</code> is included in a block.</li>
</ul>
<p><strong>Event</strong></p>
<p>The Watcher reports an <code>invalid_piggyback</code> event:</p>
<pre><code class="hljs css language-json">{
  <span class="hljs-attr">"event"</span>: <span class="hljs-string">"invalid_piggyback"</span>,
  <span class="hljs-attr">"details"</span>: {
    <span class="hljs-attr">"txbytes"</span>: <span class="hljs-string">"0xf3170101c0940000..."</span>,
    <span class="hljs-attr">"inputs"</span>: [<span class="hljs-number">1</span>],
    <span class="hljs-attr">"outputs"</span>: [<span class="hljs-number">0</span>]
  }
}
</code></pre>
<p>Notes:</p>
<ul>
<li>The Watcher does not report a <code>noncanonical_ife</code> event as <code>TX1</code> is a canonical transaction included in a valid block.</li>
<li>The <code>invalid_piggyback</code> event can be reported only once <code>TX2</code> has been detected by the Watcher, either as part of a valid block (as in the scenario above) or if referenced by another in-flight exit.</li>
</ul>
<p><strong>Solution</strong></p>
<ul>
<li>Carol uses <code>TX2</code> to challenge Bob's piggyback.</li>
<li>Bob does not exit his output, and Carol receives the <code>piggyback bond</code> committed by Bob,</li>
</ul>
<p><strong>Implementation</strong></p>
<pre><code class="hljs css language-js"><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">challengeInvalidPiggyback</span> (<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">const</span> challengeData = <span class="hljs-keyword">await</span> childChain.inFlightExitGetOutputChallengeData(exitData.in_flight_tx, inputIndex)
  <span class="hljs-keyword">return</span> rootChain.challengeInFlightExitOutputSpent({
    <span class="hljs-attr">inFlightTx</span>: challengeData.in_flight_txbytes,
    <span class="hljs-attr">inFlightTxInclusionProof</span>: challengeData.in_flight_proof,
    <span class="hljs-attr">inFlightTxOutputPos</span>: challengeData.in_flight_output_pos,
    <span class="hljs-attr">challengingTx</span>: challengeData.spending_txbytes,
    <span class="hljs-attr">challengingTxInputIndex</span>: challengeData.spending_input_index,
    <span class="hljs-attr">challengingTxWitness</span>: challengeData.spending_sig,
    <span class="hljs-attr">txOptions</span>: {
      <span class="hljs-attr">privateKey</span>: CarolPrivateKey,
      <span class="hljs-attr">from</span>: Carol
    }
  })
}
</code></pre>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/challenge-period"><span class="arrow-prev">← </span><span>Challenge Period</span></a><a class="docs-next button" href="/process-exits"><span>Process Exits</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#lifecycle">Lifecycle</a></li><li><a href="#watcher-alerts">Watcher Alerts</a></li><li><a href="#challenging-standard-exits">Challenging Standard Exits</a></li><li><a href="#challenging-in-flight-exits">Challenging In-Flight Exits</a></li></ul></nav></div><div class="footer-content"><div class="footer-wrapper"><div class="footer-column"><span class="footer-title">Getting Started</span><span class="footer-item"><a target="_blank" href="https://github.com/omisego/dev-portal/blob/master/guides/morevp_eli5.md">Learn MoreVP
Architecture</a></span><span class="footer-item"><a target="_blank" href="https://github.com/omisego/dev-portal/blob/master/guides/plasma_interface_from_browser.md">Get to know
the Plasma Interface</a></span></div><div class="footer-column"><span class="footer-title">APIs</span><span class="footer-item"><a target="_blank" href="https://developer.omisego.co/elixir-omg/docs-ui/?url=master%2Foperator_api_specs.yaml&amp;urls.primaryName=master%2Finfo_api_specs">Watcher
Informational API</a></span><span class="footer-item"><a target="_blank" href="https://developer.omisego.co/elixir-omg/docs-ui/?url=master%2Foperator_api_specs.yaml&amp;urls.primaryName=master%2Fsecurity_critical_api_specs">Watcher
Security Critical API</a></span><span class="footer-item"><a target="_blank" href="https://developer.omisego.co/elixir-omg/docs-ui/?url=0.2/operator_api_specs.yaml">Child Chain API</a></span></div><div class="footer-column"><span class="footer-title">Documentation</span><span class="footer-item"><a target="_blank" href="https://github.com/omisego/elixir-omg/blob/master/README.md">OMG Network</a></span><span class="footer-item"><a target="_blank" href="https://github.com/omisego/omg-js/blob/master/README.md">omg-js</a></span></div><div class="footer-column"><span class="footer-title">Links</span><span class="footer-item"><a target="_blank" href="https://blockexplorer.ropsten.v1.omg.network">Block Explorer</a></span><span class="footer-item"><a target="_blank" href="https://omisego.co/">OmiseGO</a></span><span class="footer-item"><a target="_blank" href="https://github.com/omisego">GitHub</a></span></div><div class="footer-column" style="position:relative"><span class="footer-title">Follow us</span><span class="footer-item"><a target="_blank" href="https://twitter.com/omise_go"><img src="/img/twitter.svg" alt="twitter" class="footer-social"/></a><a target="_blank" href="https://www.linkedin.com/company/omisego/"><img src="/img/linkedin.svg" alt="linkedin" class="footer-social"/></a><a target="_blank" href="https://github.com/omisego"><img src="/img/github.svg" alt="github" class="footer-social"/></a><a target="_blank" href="https://reddit.com/r/omise_go/"><img src="/img/reddit.svg" alt="reddit" class="footer-social"/></a><a target="_blank" href="https://www.youtube.com/channel/UC-NfGRxTkJfVbFgyJoOxzCQ"><img src="/img/youtube.svg" alt="youtube" class="footer-social"/></a></span><span class="footer-copyright">© 2019-present OmiseGO.
All rights reserved</span></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: 'af8e7b1e7bcb8af0f31e1c3aca2f8d16',
                indexName: 'omisego',
                inputSelector: '#search_input_react'
              });
            </script></body></html>